# Claude Code コンテキスト管理ガイド

## 推奨ワークフロー

### タスク開始時
1. `/cost` で現在のトークン使用量を確認
2. 前タスクと無関係なら `/clear` でリセット

### タスク実行中
- 10-15メッセージ後、または5Mトークン超過時に `/compact`
- 20イテレーション以内で完了を目指す

### タスク完了時
- `/clear` で次タスクに備える

## ツール選択フローチャート

```
ファイル操作が必要?
├─ 単一ファイル読み込み → Read
├─ ファイル編集 → Edit
├─ 新規ファイル作成 → Write
└─ パターン検索 → Glob/Grep

コード探索が必要?
├─ 特定ファイル/クラス検索 → Glob
├─ コード内テキスト検索 → Grep
└─ 広範囲の調査 → Task(Explore)

リファクタリングが必要?
├─ 1-4ファイル → Edit
└─ 5ファイル以上 → Serena MCP
    ├─ rename_symbol
    ├─ find_referencing_symbols
    └─ replace_symbol_body
```

## MCP サーバー使い分け

| サーバー | 用途 | トークンコスト |
|---------|------|---------------|
| なし（標準ツール） | 日常的な開発 | 最小 |
| Context7 | ライブラリドキュメント参照 | 中 |
| Serena | 大規模リファクタリング | 大 |
| Chrome DevTools | UIテスト・デバッグ | 中 |

## Tips

- サブエージェント（Task）を活用してメインコンテキストを汚染しない
- 詳細調査は `Task(Explore)` に委任
- 計画立案は `EnterPlanMode` を活用
