---
name: serena
description: トークン効率重視のSerena MCP統合スキル。問題タイプを自動検出し、Debug/Design/Implementation/Optimize パターンから適切なアプローチを選択。複数オプション（-q快速, -d深層, -c重点分析, -s段階的）をサポート。
---

# Serena MCP 統合スキル

Claude Code を強化する Serena MCP を活用した、トークン効率重視のコード開発・問題解決スキルです。

---

## 🚀 クイックスタート

```bash
# 基本的な使用方法
/serena <問題> [オプション]

# 例
/serena "ログインバグを修正"           # 基本モード
/serena "ログインバグを修正" -q        # 高速モード
/serena "認証システムを設計" -d        # 深層分析
/serena "パフォーマンスを改善" -c      # コード重視分析
/serena "ダッシュボード機能を実装" -s  # 段階的実装
```

---

## 📋 使用タイミング

このスキルを使用すべき場面：

- **バグ修正**: エラーの原因不明、修正方針が不明確
- **設計**: アーキテクチャ、システム構成の決定が必要
- **実装**: 新機能の開発、複雑な処理の実装
- **最適化**: パフォーマンス改善、リファクタリング
- **分析**: コード品質評価、改善点の特定
- **意思決定**: 技術選定、方針の検討

---

## 🎯 オプション一覧

| オプション | 説明 | 思考ステップ数 | 適用場面 |
|-----------|------|--------------|--------|
| `-q` | 快速モード（Quick） | 3-5 | シンプルなバグ、小さな機能 |
| `-d` | 深層モード（Deep） | 10-15 | 複雑なシステム、重要な決定 |
| `-c` | コード重視（Code-focused） | 5-8 | リファクタリング、最適化 |
| `-s` | 段階的実装（Step-by-step） | 8-12 | 機能開発、Todo作成 |
| `-v` | 詳細出力（Verbose） | - | プロセス確認、学習用 |
| `-r` | リサーチ含む（Research） | +2-3 | 技術選定、新しい領域 |
| `-t` | Todo作成（Todo） | - | プロジェクト管理 |

---

## 📖 使用パターン

### パターン1: シンプルなバグ修正

```bash
/serena "ボタンクリックで状態が更新されない" -q
```

**実行内容**:
1. エラー症状の分析
2. 関連コード確認
3. 最可能性の高い3つ原因をリスト化
4. 修正案1つを提示
5. 実装ステップ提案

**出力結果**: 短時間で具体的な修正アクションが提供される

---

### パターン2: 複雑なシステム設計

```bash
/serena "マイクロサービスアーキテクチャに移行" -d -r -v
```

**実行内容**:
1. 要件の明確化
2. 制約条件と前提の確認
3. 複数のアーキテクチャ候補を比較
4. 技術スタックの比較検討
5. 段階的な移行計画作成
6. リスク評価と対策検討

**出力結果**: 詳細な設計書と実装ロードマップ

---

### パターン3: 段階的な機能開発

```bash
/serena "ユーザーダッシュボード機能を実装" -s -c
```

**実行内容**:
1. 機能仕様の確認
2. 技術アプローチの選定
3. コンポーネント・モジュール設計
4. 実装順序の決定
5. 各ステップの詳細タスク化
6. テスト戦略の提案

**出力結果**: 実行可能なTodoリスト付き実装計画

---

### パターン4: パフォーマンス最適化

```bash
/serena "ページロード時間が10秒かかる" -c
```

**実行内容**:
1. ボトルネック候補の分析
2. 現在のコード読み込み
3. 最適化対象の特定
4. 複数の改善案を提示
5. 実装優先度の提案

**出力結果**: 具体的な最適化テクニックと実装例

---

## 🧠 問題タイプの自動検出

キーワードから自動的にアプローチが選択されます：

### Debug パターン（5-8思考）
トリガーキーワード: error, bug, issue, broken, failing, crash, 動かない, エラー

**流れ**:
1. 症状分析と再現
2. エラーコンテキスト確認
3. 根本原因仮説生成
4. エビデンス収集と検証
5. 解決策設計とリスク評価
6. 実装計画
7. 検証戦略
8. 予防対策

---

### Design パターン（8-12思考）
トリガーキーワード: architecture, system, design, structure, plan, 設計, システム

**流れ**:
1. 要件の明確化
2. 制約条件の確認
3. 複数案の生成
4. 各案の評価
5. 技術選定
6. 設計意思決定
7. 実装フェーズ計画
8. リスク評価
9. 成功指標
10. 検証計画
11. ドキュメント化

---

### Implementation パターン（6-10思考）
トリガーキーワード: build, create, add, feature, implement, 実装, 追加

**流れ**:
1. 機能仕様と範囲
2. 技術アプローチ選定
3. コンポーネント設計
4. 依存関係と統合ポイント
5. 実装順序
6. テスト戦略
7. エッジケース対応
8. パフォーマンス考慮
9. エラーハンドリング
10. デプロイ計画

---

### Review/Optimize パターン（4-7思考）
トリガーキーワード: optimize, improve, refactor, review, performance, slow, 最適化, 改善

**流れ**:
1. 現状分析
2. ボトルネック特定
3. 改善機会の洗出
4. 解決案と実現性評価
5. 実装優先度
6. パフォーマンス影響予測
7. 検証と監視計画

---

## 🔧 高度なオプション

```bash
# 思考ステップ数を明示的に指定
/serena "複雑な問題" --max-thoughts=20

# 特定領域に焦点を当てる
/serena "パフォーマンス課題" --focus=backend

# 特定ファイルから分析開始
/serena "型チェックエラー" --context=src/types.ts,src/models.ts

# トークン予算を意識した最適化
/serena "大規模リファクタリング" --token-budget=50000

# JSON形式で結果を出力（自動化向け）
/serena "API設計" --json

# 要約のみ（詳細は要求時）
/serena "プロジェクト概要" --summary

# 段階的表示（サマリー先出し）
/serena "複合的な分析" --progressive
```

---

## 🎓 実行フロー

Serena スキルが呼ばれた時の内部フロー：

```
入力
  ↓
[1] 問題タイプの自動検出
  ├─ キーワード分析
  └─ 適切なパターン選択（Debug/Design/Implement/Review）
  ↓
[2] オプションの解析
  ├─ -q/-d/-c/-s の適用
  ├─ -v/-r/-t の有効化
  └─ 思考ステップ数の決定
  ↓
[3] Serena MCP の実行
  ├─ セマンティック コード解析
  ├─ シンボル検索と参照追跡
  └─ パターンに沿った思考プロセス
  ↓
[4] 出力形式の適用
  ├─ デフォルト: キーアクションとレコメンデーション
  ├─ Verbose (-v): 全思考プロセス表示
  ├─ Todo (-t): 実行可能なタスク化
  └─ JSON (--json): 自動化向けフォーマット
  ↓
結果出力
```

---

## 💡 活用のコツ

### トークン効率を最大化する

```bash
# ❌ 非効率: 長い説明を含む
/serena "何か複雑なことをしたいのだが、詳しい背景はこうで、これまでこう試してきた"

# ✅ 効率的: 簡潔+オプション指定
/serena "複雑な問題" -d    # キーワードだけで十分
```

### 段階的な問題解決

```bash
# 1. まず概要をつかむ
/serena "新しい技術の導入" --summary

# 2. 詳細が必要ならフル実行
/serena "新しい技術の導入" -d -r

# 3. 実装段階では段階的実装
/serena "新しい技術の導入" -s -t
```

### チームでの活用

```bash
# 技術検討会向け: JSON出力で共有可能な形に
/serena "アーキテクチャ選定" -d --json

# ドキュメント作成向け: 詳細出力を記録
/serena "システム設計" -d -v > design-doc.md

# 実装計画作成向け: Todo自動作成
/serena "機能実装計画" -s -t
```

---

## 🤖 AI アシスタント指示

このスキルが有効な場合、以下を実行：

1. **問題の理解**
   - ユーザー入力から問題タイプを自動検出
   - キーワード分析で Debug/Design/Implement/Review を判定
   - 不明確な点は質問して明確化

2. **Serena MCP の実行**
   - 選択したパターンに対応する思考ステップ数で実行
   - セマンティック コード解析ツールで深く理解
   - 関連シンボル、参照、パターンを追跡

3. **トークン最適化**
   - `-q` オプション時は不要な詳細を削除
   - `-d` オプション時は隅々まで分析
   - 思考の効率化に集中

4. **出力の最適化**
   - Default: 主要な発見 + 推奨アクションをコンパクトに
   - Verbose: 全思考プロセスを透明に表示
   - Todo: 実行可能なタスクリスト化
   - JSON: 構造化形式で自動処理可能に

5. **実装の指南**
   - 具体的な実装例を提供
   - 必要に応じてコード修正を実施
   - テスト戦略も含める

---

## ⚙️ 設定と統合

### 推奨される組み合わせ

```bash
# バグ修正フロー
/serena <問題> -q  → 高速で原因特定

# システム設計フロー
/serena <要件> -d -r -v  → 詳細な検討

# 機能開発フロー
/serena <仕様> -s -t -c  → 実行可能計画を作成

# パフォーマンス改善フロー
/serena <課題> -c --focus=backend  → コード重視分析
```

---

## 📚 参考資料

- Serena MCP: https://github.com/oraios/serena
- Claude Code: https://claude.com/claude-code
- トークン効率ベストプラクティス: セマンティック解析で必要なコード部分のみ読み込み
