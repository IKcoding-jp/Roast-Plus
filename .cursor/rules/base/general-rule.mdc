---
description: タスク進行・品質管理の共通ルール
alwaysApply: true
---

# 進め方
- 着手前にゴール/制約/リスクを確認し、曖昧点は先に質問。  
- 作業は小さなステップで実施し、変更範囲を最小化。  
- Firestore 整合性（9台同時利用）を最優先。楽観的更新・端末時計依存は禁止。  
- コード変更は `apply_patch` 等で明示的に行い、不要な差分を出さない。

# 品質・禁止事項
- Firestore は Single Source of Truth。UI状態を先行書き込みで上書きしない。  
- setTimeout 等による段階的書き込み禁止。一操作一書き込み。  
- `any`禁止、型は `types/index.ts` に追加。  
- 端末時刻での判定/表示禁止。`serverTimestamp()` または保存値を使用。

# エラーハンドリング
- 例外は握り潰さず `console.error` とユーザー通知をセットで実施。  
- バックエンド/API呼び出しは失敗前提でリトライやフォールバックを検討。  
- Firebase 認証・書き込み失敗時は UI 上の状態を復旧するかリロード導線を提示。

# レポート/コミット
- 報告は日本語の箇条書きで「変更概要 / 解消したリスク / 未確認事項 / 確認手順 / 次の一手」を簡潔に記述。  
- 指示に従い短いコミットメッセージを提示（例: `chore: add cursor rules`）。  
- コード参照時はパスをバッククォートで明示、不要な長大コード貼付は避ける。

# テスト指針
- 可能な限り `npm run lint` などの静的検査を実施。  
- 動作確認が必要な場合は手順を箇条書きで提示（例: 認証→ページ遷移→Firestore反映確認）。  
- テストコードは振る舞いを検証し、副作用はモック。Firestore 依存は分離してユーティリティをテスト。
