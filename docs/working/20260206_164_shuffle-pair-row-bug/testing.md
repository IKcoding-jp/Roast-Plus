# テスト計画

**Issue**: #164
**作成日**: 2026-02-06

## テスト戦略

### 1. ユニットテスト（Vitest）

#### 対象: `app/assignment/lib/shuffle.ts`

**テストファイル**: `app/assignment/lib/__tests__/shuffle.test.ts`（既存の場合は追加、なければ新規作成）

#### テストケース

##### ケース1: 行の連続回避
```
入力:
  - members: A, B, C, D, E, F (6人)
  - taskLabels: Task1, Task2, Task3 (3行)
  - teams: Team1, Team2 (2班)
  - history[0] (前回): A→Task1, B→Task1, C→Task2, D→Task2, E→Task3, F→Task3

期待:
  - A, B は Task1 以外の行に配置される
  - C, D は Task2 以外の行に配置される
  - E, F は Task3 以外の行に配置される
```

##### ケース2: ペアの連続回避
```
入力:
  - history[0] (前回): (A,B)がTask1、(C,D)がTask2

期待:
  - (A,B) が同じ行に配置されない
  - (C,D) が同じ行に配置されない
```

##### ケース3: 複数回シャッフルの一貫性
```
入力:
  - 同じ入力で100回シャッフルを実行

期待:
  - 前回の結果と同じ行・同じペアになる割合が統計的に低い
  - 行の連続: 0%（完全回避）
  - ペアの連続: 5%未満（ほぼ回避）
```

##### ケース4: メンバー数が少ない場合（エッジケース）
```
入力:
  - members: A, B (2人のみ)
  - taskLabels: Task1 (1行のみ)
  - teams: Team1, Team2

期待:
  - エラーが発生しない
  - 割り当てが完了する（ペア回避は不可能なので許容）
```

##### ケース5: ペア除外設定の維持
```
入力:
  - pairExclusions: [(A, B)]
  - 十分なメンバー数

期待:
  - A と B が同じ行に配置されない（100回実行で0回）
```

##### ケース6: 2回前の履歴も考慮
```
入力:
  - history[0] (1回前): A→Task1
  - history[1] (2回前): A→Task2

期待:
  - A は Task1, Task2 以外の行に配置される（可能な場合）
```

### 2. 実機検証（Chrome DevTools MCP）

#### 検証手順
1. 開発サーバー起動（`npm run dev`）
2. `/assignment` ページにアクセス
3. 現在の割り当て状態を記録
4. シャッフル実行
5. 結果を記録し、以下を確認:
   - 各メンバーの行が前回と異なるか
   - 各行のペアが前回と異なるか
6. 手順4-5を最低3回繰り返す
7. 全回で要件を満たしていることを確認

#### 判定基準
- 行の連続: **0件** であること（前回と同じ行のメンバーがいない）
- ペアの連続: **0件** であること（前回と同じペアがいない）
- エラー: 発生しないこと

### 3. 回帰テスト

- [ ] `npm run lint` — Lintエラー・warningゼロ
- [ ] `npm run test` — 全テスト合格
- [ ] `npm run build` — ビルドエラーなし

## カバレッジ目標
- `app/assignment/lib/shuffle.ts`: 80%以上
- 特にcalculateAssignment関数の分岐カバレッジを重視
