# タスクリスト

**Issue**: #164
**作成日**: 2026-02-06

## フェーズ1: バグ原因の詳細特定
- [ ] shuffle.tsのcalculateAssignment関数を読解し、バグ箇所を特定
- [ ] 行243のペア回避条件の問題を確認
- [ ] neededCount別（2人、3人、4人）の動作シミュレーション
- [ ] 既存テストの有無を確認

## フェーズ2: アルゴリズム修正
- [ ] ペア回避条件（行243付近）の修正
  - selectedMembersの最後の1人でもペア回避を試みるようにする
  - フォールバック: 全候補がペナルティ高い場合のみ許容
- [ ] 行の連続回避ロジック強化
  - スコアリングで行ペナルティとペアペナルティを統合的に評価
  - 「スキップ」ではなく「スコアの加算」で制御するように変更
- [ ] 試行ループの最適化
  - 完璧判定基準の見直し（ランダムノイズの影響排除）
  - 必要に応じて試行回数の調整

## フェーズ3: Chrome DevToolsでの実機検証
- [ ] 開発サーバーを起動
- [ ] Chrome DevTools MCPで担当票ページにアクセス
- [ ] シャッフルを実行し、結果を記録
- [ ] 2回目のシャッフルを実行し、前回との差異を確認
  - 全メンバーが前回と異なる行に配置されているか
  - 全ペアが前回と異なる組み合わせになっているか
- [ ] 3回目以降も繰り返し、一貫して要件を満たすことを確認
- [ ] 問題が見つかった場合はフェーズ2に戻って修正

## フェーズ4: 回帰テスト・PR作成
- [ ] Lintエラー・warningがないことを確認
- [ ] 既存テストが通過することを確認
- [ ] 必要に応じてシャッフルロジックのユニットテストを追加
- [ ] PRを作成（Closes #164）

## 依存関係
- フェーズ1 → フェーズ2（原因特定後に修正）
- フェーズ2 ↔ フェーズ3（修正と検証を反復）
- フェーズ3 → フェーズ4（検証合格後にPR）
