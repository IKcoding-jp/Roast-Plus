---
description: TypeScript/React/Next.jsの実装ガイドライン
alwaysApply: true
---

# 型とコーディング
- `any`禁止。`unknown`→狭義化、ユニオン/nullableを明示。共有型は`types/index.ts`に集約。  
- オブジェクトは読み取り専用が妥当なら`readonly`/`as const`を活用。IDや種別はリテラル型で表現。  
- 日付文字列は ISO (`YYYY-MM-DD` / ISO 8601) で保持し、`Date`オブジェクトを状態に残さない。  
- 例: `AppData`/`Assignment` などの型は [`types/index.ts`](../../../types/index.ts) を参照。

# React / Next.js
- サーバーコンポーネントをデフォルトとし、ブラウザAPI・localStorage・イベントリスナーが必要な場合のみ `'use client'`。  
- 副作用・購読はカスタムフックへ分離（例: [`hooks/useAppData.ts`](../../../hooks/useAppData.ts)）。UIは props で受け取って表示に専念。  
- ページ/レイアウトは App Router 構文を使用し、データフェッチはサーバー側優先。クライアント状態が必要なら hook で管理。

# Firebase / Firestore
- Firestore アクセスは `lib/firestore.ts` 経由に限定。コンポーネントから直接 SDK を呼ばない。  
- 書き込みは一操作一回、複数フィールドはトランザクション or 直列キューで競合回避（例: [`lib/firestore.ts`](../../../lib/firestore.ts)）。  
- ローカル時刻禁止。`serverTimestamp()` または Firestore 保存値を利用し、UI には文字列を渡す。

# エラーハンドリング
- 例外は握り潰さず `console.error` とユーザー通知（Toast等）を併記。  
- ネットワーク/API呼び出しは失敗前提でリトライ/バックオフを検討。  
- 例: 認証エラー処理は [`app/login/page.tsx`](../../../app/login/page.tsx) のパターンを踏襲。

# スタイリング / UI
- Tailwind CSS v4 を使用。モバイルファースト、タッチターゲット44px以上。  
- クラスはインライン指定し、テーマトーン（ブラウン系/ホワイト基調）を維持。  
- アクセシビリティを考慮し、aria-labelやroleを適宜付与。  
- トーストは共通プロバイダを使用（例: [`components/Toast.tsx`](../../../components/Toast.tsx)）。

# パフォーマンス / UX
- 必要なデータだけ取得し、不要な再レンダリングを避けるために `useMemo`/`useCallback` を適切に使用。  
- Debounce/Throttle は Firestore 書き込み混雑を防ぐ目的でのみ慎重に導入。  
- スプラッシュやローディングは最小限で早期ナビゲーションを優先（例: [`app/page.tsx`](../../../app/page.tsx)）。
