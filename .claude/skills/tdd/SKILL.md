---
name: tdd
description: ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºï¼ˆTDDï¼‰ã‚¹ã‚­ãƒ«ã€‚Redâ†’Greenâ†’Refactorã‚µã‚¤ã‚¯ãƒ«ã§ã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè£…ã€‚testing.mdãŒã‚ã‚Œã°SDDã¨é€£æºã€ãªãã¦ã‚‚ã‚¹ã‚¿ãƒ³ãƒ‰ã‚¢ãƒ­ãƒ³ã§ä½¿ç”¨å¯èƒ½ã€‚ã€Œ/tdd å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«ã€ã€Œ/tdd æ©Ÿèƒ½èª¬æ˜ã€ã®ã‚ˆã†ã«ä½¿ç”¨ã€‚
argument-hint: "[å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ or æ©Ÿèƒ½èª¬æ˜]"
---

# TDDï¼ˆãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºï¼‰ã‚¹ã‚­ãƒ«

## ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼æ¦‚è¦

```
ãƒ†ã‚¹ãƒˆè¨­è¨ˆ â†’ Redï¼ˆå¤±æ•—ãƒ†ã‚¹ãƒˆï¼‰ â†’ Greenï¼ˆæœ€å°å®Ÿè£…ï¼‰ â†’ Refactorï¼ˆæ”¹å–„ï¼‰ â†’ å®Œäº†
                 ğŸ”´ ã‚³ãƒŸãƒƒãƒˆ         ğŸŸ¢ ã‚³ãƒŸãƒƒãƒˆ         ğŸ”µ ã‚³ãƒŸãƒƒãƒˆ
```

**åŸå‰‡: ãƒ†ã‚¹ãƒˆã‚’å…ˆã«æ›¸ãã€‚ãƒ†ã‚¹ãƒˆãªã—ã®å®Ÿè£…ã‚³ãƒŸãƒƒãƒˆã¯è¡Œã‚ãªã„ã€‚**

---

## é©ç”¨åˆ¤å®š

### TDDå¿…é ˆï¼ˆã“ã®ã‚¹ã‚­ãƒ«ã§å®Ÿè£…ï¼‰

| å¯¾è±¡ | ç†ç”± |
|------|------|
| `lib/` ãƒ­ã‚¸ãƒƒã‚¯é–¢æ•° | ç´”ç²‹é–¢æ•°ã€å…¥å‡ºåŠ›ãŒæ˜ç¢º |
| `hooks/` ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯ | renderHookã§æ¤œè¨¼å¯èƒ½ |
| `components/` ã®ãƒ­ã‚¸ãƒƒã‚¯éƒ¨åˆ† | çŠ¶æ…‹é·ç§»ãƒ»ã‚¤ãƒ™ãƒ³ãƒˆå‡¦ç† |
| ãƒã‚°ä¿®æ­£ | å›å¸°ãƒ†ã‚¹ãƒˆã§å†ç™ºé˜²æ­¢ |

### TDDå¯¾è±¡å¤–ï¼ˆåˆ¥ã‚¢ãƒ—ãƒ­ãƒ¼ãƒï¼‰

| å¯¾è±¡ | ä»£æ›¿æ‰‹æ³• |
|------|---------|
| ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«èª¿æ•´ï¼ˆé…è‰²ãƒ»ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼‰ | ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«åå¾©å‹ãƒ•ãƒ­ãƒ¼ |
| `docs/` ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ | ãã®ã¾ã¾ç·¨é›† |
| `chore` è¨­å®šå¤‰æ›´ | ãã®ã¾ã¾ç·¨é›† |

---

## Phase 1: ãƒ†ã‚¹ãƒˆè¨­è¨ˆ

### 1.1 Working Documentsé€£æºï¼ˆSDDãƒ¢ãƒ¼ãƒ‰ï¼‰

`testing.md` ãŒå­˜åœ¨ã™ã‚‹å ´åˆï¼ˆ`/fix-issue` ã‹ã‚‰å‘¼ã°ã‚ŒãŸå ´åˆï¼‰:

```
docs/working/{YYYYMMDD}_{Issueç•ªå·}_{ã‚¿ã‚¤ãƒˆãƒ«}/testing.md
  â†’ ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ãƒ»ã‚«ãƒãƒ¬ãƒƒã‚¸ç›®æ¨™ã‚’èª­ã¿è¾¼ã¿
  â†’ ã“ã‚Œã‚’ãƒ†ã‚¹ãƒˆè¨­è¨ˆã®ã‚¤ãƒ³ãƒ—ãƒƒãƒˆã¨ã™ã‚‹
```

### 1.2 ã‚¹ã‚¿ãƒ³ãƒ‰ã‚¢ãƒ­ãƒ³ãƒ¢ãƒ¼ãƒ‰

`testing.md` ãŒãªã„å ´åˆï¼ˆ`/tdd` å˜ç‹¬å®Ÿè¡Œã®å ´åˆï¼‰:

1. **å¯¾è±¡ã‚³ãƒ¼ãƒ‰ã‚’åˆ†æ**
   - Serena MCPã§ `get_symbols_overview` â†’ `find_symbol` ã§æ§‹é€ æŠŠæ¡
   - é–¢æ•°ã®ã‚·ã‚°ãƒãƒãƒ£ã€å…¥å‡ºåŠ›ã®å‹ã‚’ç¢ºèª

2. **ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã‚’è¨­è¨ˆ**
   - æ­£å¸¸ç³»ï¼ˆä¸»è¦ãªãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ï¼‰
   - ç•°å¸¸ç³»ï¼ˆã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã€null/undefinedï¼‰
   - å¢ƒç•Œå€¤ï¼ˆ0ã€ç©ºé…åˆ—ã€æœ€å¤§å€¤ï¼‰
   - ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ï¼ˆä¸¦è¡Œå‡¦ç†ã€ã‚¿ã‚¤ãƒŸãƒ³ã‚°ä¾å­˜ï¼‰

3. **è¨­è¨ˆã‚’ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«æç¤º**

```
ğŸ“‹ ãƒ†ã‚¹ãƒˆè¨­è¨ˆ:

å¯¾è±¡: lib/coffee-quiz/gamification.ts - calculateXP()

ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹:
1. âœ… æ­£å¸¸ç³»: easy â†’ 10XP, medium â†’ 20XP, hard â†’ 30XP
2. âœ… æ­£å¸¸ç³»: ã‚¹ãƒˆãƒªãƒ¼ã‚¯ãƒœãƒ¼ãƒŠã‚¹é©ç”¨
3. âŒ ç•°å¸¸ç³»: ä¸æ­£ãªé›£æ˜“åº¦ â†’ ã‚¨ãƒ©ãƒ¼
4. ğŸ”² å¢ƒç•Œå€¤: ã‚¹ãƒˆãƒªãƒ¼ã‚¯0æ—¥

ã“ã®ãƒ†ã‚¹ãƒˆè¨­è¨ˆã§é€²ã‚ã¾ã™ã‹ï¼Ÿ
```

âš ï¸ **ã‚¹ã‚¿ãƒ³ãƒ‰ã‚¢ãƒ­ãƒ³ãƒ¢ãƒ¼ãƒ‰ã§ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ç¢ºèªã‚’å–ã‚‹ã€‚SDDãƒ¢ãƒ¼ãƒ‰ã§ã¯ testing.md ã‚’ä¿¡é ¼ã—ã¦é€²è¡Œã€‚**

---

## Phase 2: Redï¼ˆå¤±æ•—ãƒ†ã‚¹ãƒˆä½œæˆï¼‰ğŸ”´

### 2.1 ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ

ãƒ†ã‚¹ãƒˆå¯¾è±¡ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¨åŒã˜ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã€ã¾ãŸã¯éš£æ¥ã™ã‚‹ `__tests__/` ã«ä½œæˆ:

```
å¯¾è±¡: lib/coffee-quiz/gamification.ts
ãƒ†ã‚¹ãƒˆ: lib/coffee-quiz/gamification.test.ts
```

### 2.2 ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ä½œæˆãƒ«ãƒ¼ãƒ«

```typescript
import { describe, it, expect } from 'vitest';

describe('calculateXP', () => {
  // Phase 1ã®ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã‚’ãã®ã¾ã¾å®Ÿè£…
  it('easyã®å ´åˆ10XPã‚’è¿”ã™', () => {
    expect(calculateXP('easy')).toBe(10);
  });

  it('ä¸æ­£ãªé›£æ˜“åº¦ã®å ´åˆã‚¨ãƒ©ãƒ¼ã‚’æŠ•ã’ã‚‹', () => {
    expect(() => calculateXP('invalid' as any)).toThrow();
  });
});
```

**ãƒ†ã‚¹ãƒˆã®å“è³ªåŸºæº–:**
- ãƒ†ã‚¹ãƒˆåã¯æ—¥æœ¬èªã§ã€Œä½•ã‚’ã—ãŸã‚‰ä½•ãŒèµ·ãã‚‹ã€ã‚’è¨˜è¿°
- 1ãƒ†ã‚¹ãƒˆ1ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ ã‚’åŸºæœ¬ã¨ã™ã‚‹ï¼ˆé–¢é€£ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ã®è¤‡æ•°ã¯è¨±å®¹ï¼‰
- AAAãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆArrange-Act-Assertï¼‰ã«å¾“ã†
- ãƒ¢ãƒƒã‚¯ã¯æœ€å°é™ï¼ˆvi.mock ã® hoisting å•é¡Œã«æ³¨æ„ï¼‰

### 2.3 Redç¢ºèª

```bash
npm run test -- å¯¾è±¡ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«
```

**å…¨ãƒ†ã‚¹ãƒˆãŒå¤±æ•—ã™ã‚‹ï¼ˆRedï¼‰ã“ã¨ã‚’ç¢ºèªã€‚**

æ—¢å­˜ãƒ†ã‚¹ãƒˆãŒå£Šã‚Œã¦ã„ãªã„ã‹ã‚‚ç¢ºèª:

```bash
npm run test
```

### 2.4 Redã‚³ãƒŸãƒƒãƒˆ

```bash
git add å¯¾è±¡ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«
git commit -m "test(#Issueç•ªå·): å¤±æ•—ãƒ†ã‚¹ãƒˆã‚’è¿½åŠ  - æ©Ÿèƒ½èª¬æ˜"
```

âš ï¸ **Issueç•ªå·ãŒãªã„å ´åˆï¼ˆã‚¹ã‚¿ãƒ³ãƒ‰ã‚¢ãƒ­ãƒ³ï¼‰ã¯ã‚¹ã‚³ãƒ¼ãƒ—ã«ãƒ•ã‚¡ã‚¤ãƒ«åã‚’ä½¿ç”¨:**
```bash
git commit -m "test(gamification): å¤±æ•—ãƒ†ã‚¹ãƒˆã‚’è¿½åŠ  - calculateXP"
```

---

## Phase 3: Greenï¼ˆæœ€å°å®Ÿè£…ï¼‰ğŸŸ¢

### 3.1 å®Ÿè£…ã®åŸå‰‡

**ãƒ†ã‚¹ãƒˆã‚’é€šã™æœ€å°é™ã®ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãã€‚**

- éåº¦ãªæŠ½è±¡åŒ–ã‚’ã—ãªã„
- å°†æ¥ã®æ‹¡å¼µã‚’è€ƒæ…®ã—ãªã„
- ãƒ†ã‚¹ãƒˆãŒè¦æ±‚ã™ã‚‹æŒ¯ã‚‹èˆã„ã ã‘ã‚’å®Ÿè£…

### 3.2 åå¾©ã‚µã‚¤ã‚¯ãƒ«

```
å®Ÿè£…ã‚’å°‘ã—æ›¸ã
    â†“
ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ: npm run test -- å¯¾è±¡ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«
    â†“
  åˆæ ¼ï¼Ÿ â”€â”€â”€ No â†’ å®Ÿè£…ã‚’ä¿®æ­£ï¼ˆãƒ«ãƒ¼ãƒ—ï¼‰
    â”‚
   Yes
    â†“
  å…¨ãƒ†ã‚¹ãƒˆåˆæ ¼ï¼Ÿ â”€â”€â”€ No â†’ æ¬¡ã®ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã¸ï¼ˆãƒ«ãƒ¼ãƒ—ï¼‰
    â”‚
   Yes
    â†“
  Greené”æˆ âœ…
```

### 3.3 Greenç¢ºèª

```bash
# å¯¾è±¡ãƒ†ã‚¹ãƒˆãŒå…¨ã¦åˆæ ¼
npm run test -- å¯¾è±¡ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«

# æ—¢å­˜ãƒ†ã‚¹ãƒˆã‚‚å£Šã‚Œã¦ã„ãªã„
npm run test
```

### 3.4 Greenã‚³ãƒŸãƒƒãƒˆ

```bash
git add å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆå®Ÿè£… + ãƒ†ã‚¹ãƒˆæ›´æ–°ãŒã‚ã‚Œã°ï¼‰
git commit -m "feat(#Issueç•ªå·): æ©Ÿèƒ½èª¬æ˜ã®å®Ÿè£…"
```

---

## Phase 4: Refactorï¼ˆæ”¹å–„ï¼‰ğŸ”µ

### 4.1 ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°å¯¾è±¡ã®åˆ¤æ–­

ä»¥ä¸‹ã®ã„ãšã‚Œã‹ã«è©²å½“ã™ã‚‹å ´åˆã®ã¿å®Ÿæ–½ï¼ˆè©²å½“ã—ãªã‘ã‚Œã°ã‚¹ã‚­ãƒƒãƒ—ï¼‰:

- é‡è¤‡ã‚³ãƒ¼ãƒ‰ãŒã‚ã‚‹
- é–¢æ•°ãŒé•·ã™ãã‚‹ï¼ˆ20è¡Œä»¥ä¸Šã®ç›®å®‰ï¼‰
- å‘½åãŒä¸é©åˆ‡
- GUIDELINES.mdã®ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¦ç´„ã«é•å

### 4.2 ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã®åŸå‰‡

**ãƒ†ã‚¹ãƒˆã‚’å¤‰æ›´ã—ãªã„ã€‚ãƒ†ã‚¹ãƒˆãŒåˆæ ¼ã—ç¶šã‘ã‚‹ã“ã¨ã‚’ä¿è¨¼ã€‚**

```
ã‚³ãƒ¼ãƒ‰æ”¹å–„
    â†“
ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ: npm run test -- å¯¾è±¡ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«
    â†“
  åˆæ ¼ï¼Ÿ â”€â”€â”€ No â†’ æ”¹å–„ã‚’ä¿®æ­£ï¼ˆãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ãŒãƒã‚°ã‚’å…¥ã‚ŒãŸï¼‰
    â”‚
   Yes
    â†“
  å®Œäº† âœ…
```

### 4.3 Refactorã‚³ãƒŸãƒƒãƒˆï¼ˆå¤‰æ›´ãŒã‚ã£ãŸå ´åˆã®ã¿ï¼‰

```bash
git add å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«
git commit -m "refactor(#Issueç•ªå·): æ©Ÿèƒ½èª¬æ˜ã®ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°"
```

---

## Phase 5: å®Œäº†

### 5.1 æœ€çµ‚æ¤œè¨¼

```bash
npm run test
npm run lint
```

### 5.2 ã‚«ãƒãƒ¬ãƒƒã‚¸ç¢ºèª

```bash
npm run test -- --coverage å¯¾è±¡ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
```

ã‚«ãƒãƒ¬ãƒƒã‚¸ç›®æ¨™:
- `lib/`: 90%ä»¥ä¸Š
- `hooks/`: 85%ä»¥ä¸Š
- `components/`: 75%ä»¥ä¸Š

### 5.3 testing.mdæ›´æ–°ï¼ˆSDDãƒ¢ãƒ¼ãƒ‰æ™‚ã®ã¿ï¼‰

testing.mdãŒå­˜åœ¨ã™ã‚‹å ´åˆã€å®Œäº†çŠ¶æ…‹ã«æ›´æ–°:

```markdown
## ãƒ†ã‚¹ãƒˆå®Ÿæ–½çµæœ
- âœ… å…¨ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹åˆæ ¼
- ã‚«ãƒãƒ¬ãƒƒã‚¸: XX%
- å®Ÿæ–½æ—¥: YYYY-MM-DD
```

### 5.4 å®Œäº†å ±å‘Š

```
âœ… TDDã‚µã‚¤ã‚¯ãƒ«å®Œäº†

ğŸ“Š çµæœ:
- ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹: Xä»¶ï¼ˆå…¨åˆæ ¼ï¼‰
- ã‚«ãƒãƒ¬ãƒƒã‚¸: XX%
- ã‚³ãƒŸãƒƒãƒˆ: ğŸ”´ Red â†’ ğŸŸ¢ Green â†’ ğŸ”µ Refactor

ğŸ“ ä½œæˆ/å¤‰æ›´ãƒ•ã‚¡ã‚¤ãƒ«:
- lib/coffee-quiz/gamification.test.tsï¼ˆæ–°è¦ï¼‰
- lib/coffee-quiz/gamification.tsï¼ˆä¿®æ­£ï¼‰
```

---

## ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹

### vi.mock ã® hoisting å•é¡Œ

```typescript
// âŒ NG: ãƒ•ã‚¡ã‚¯ãƒˆãƒªé–¢æ•°å†…ã§å¤–éƒ¨å¤‰æ•°ã‚’å‚ç…§
const MOCK_DATA = { value: 123 };
vi.mock('@/module', () => ({ data: MOCK_DATA }));

// âœ… OK: ãƒ•ã‚¡ã‚¯ãƒˆãƒªé–¢æ•°å†…ã§ç›´æ¥å®šç¾©
vi.mock('@/module', () => ({ data: { value: 123 } }));
```

### éåŒæœŸãƒ•ãƒƒã‚¯ã®ãƒ†ã‚¹ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³

```typescript
const { result } = renderHook(() => useMyHook());

// isHydratedç­‰ã®åˆæœŸåŒ–ã‚’å¾…ã¤
await act(async () => {
  await vi.runAllTimersAsync();
});

// ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
await act(async () => {
  await result.current.someFunction();
});
```

### ãƒ‡ãƒã‚¦ãƒ³ã‚¹å‡¦ç†ã®ãƒ†ã‚¹ãƒˆ

```typescript
vi.useFakeTimers();

await act(async () => {
  await debouncedFunction();
});

await act(async () => {
  vi.advanceTimersByTime(1000);
  await vi.runAllTimersAsync();
});
```

### ãƒ¢ãƒƒã‚¯ãƒ‘ã‚¹ã®å®Œå…¨ä¸€è‡´

```typescript
// å®Ÿéš›ã®importãƒ‘ã‚¹ã¨å®Œå…¨ä¸€è‡´ã•ã›ã‚‹
vi.mock('@/lib/coffee-quiz/fsrs', () => ({
  fsrs: vi.fn(),
}));
```
