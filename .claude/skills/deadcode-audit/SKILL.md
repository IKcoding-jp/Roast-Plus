---
name: deadcode-audit
description: Knipによるデッドコード検出を実行し、未使用のエクスポート・依存関係・ファイルを特定する。リファクタリングやコードクリーンアップ時に使用。
allowed-tools: Bash, Read
---

# Deadcode Audit Protocol

ユーザーからデッドコード検出やクリーンアップを求められた場合、以下の手順を実行せよ。

## 前提条件

- **Knip** がdevDependenciesにインストール済みであること
- `knip.config.ts` がプロジェクトルートに存在すること

## 実行コマンド

### 基本スキャン

```bash
npm run deadcode
```

### 詳細出力

```bash
npx knip --reporter compact
```

### 特定カテゴリのみ

```bash
npx knip --include files          # 未使用ファイルのみ
npx knip --include dependencies   # 未使用依存関係のみ
npx knip --include exports        # 未使用エクスポートのみ
```

## 検出カテゴリ

### 1. 未使用ファイル（Unused files）

どこからもインポートされていないモジュール。安全に削除可能。

### 2. 未使用の依存関係（Unused dependencies）

`package.json` に記載があるが、コード内で使われていないパッケージ。
`npm uninstall` で削除を提案。

### 3. 未使用のエクスポート（Unused exports）

`export` されているが、他のファイルから `import` されていない関数・変数・型。

**注意**: バレルファイル（`index.ts`）経由の再エクスポートは、
実際には使われていても検出される場合がある。削除前に確認が必要。

### 4. 未リストの依存関係（Unlisted dependencies）

コード内で使用されているが、`package.json` に記載がないパッケージ。
`npm install` で追加を提案。

## 分析手順

### Step 1: フルスキャン実行

```bash
npm run deadcode
```

### Step 2: カテゴリ別に分類

| カテゴリ | リスク | 対応 |
|---------|--------|------|
| 未使用ファイル | 低 | 確認後に削除 |
| 未使用依存関係 | 低 | `npm uninstall` |
| 未使用エクスポート | 中 | バレルファイル経由でないか確認後に削除 |
| 未リスト依存関係 | 高 | 即座に `npm install` |

### Step 3: 安全な削除の判断

各検出項目について：

1. **git blame** で最終変更日を確認（古いほど安全に削除可能）
2. **テスト実行** で影響がないことを確認
3. **バレルファイル** の再エクスポートは慎重に判断

## レポート出力

```markdown
# デッドコード監査レポート

**日時**: YYYY-MM-DD
**対象**: RoastPlus

## 結果サマリー

| カテゴリ | 検出数 |
|---------|--------|
| 未使用ファイル | N件 |
| 未使用依存関係 | N件 |
| 未使用エクスポート | N件 |
| 未使用エクスポート型 | N件 |
| 未リスト依存関係 | N件 |

## 詳細

### 未使用ファイル
[一覧]

### 未使用依存関係
[一覧]

### 未使用エクスポート
[一覧]

## 推奨アクション

1. [優先度順にアクションを列挙]
```

## ベースライン（2026-02-01 測定）

初回測定結果：

| カテゴリ | 件数 |
|---------|------|
| 未使用ファイル | 4件 |
| 未使用依存関係 | 3件 |
| 未使用devDependencies | 1件 |
| 未リスト依存関係 | 2件 |
| 未使用エクスポート | 76件 |
| 未使用エクスポート型 | 25件 |
